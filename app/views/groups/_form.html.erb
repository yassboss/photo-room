<%=form_with model: @group, local: true do |f|%>
<%= render 'layouts/error_messages', model: f.object %>
  <div class="field">
    <%= f.label :name, 'グループ名（必須）' %><br />
    <%= f.text_field :name, autofocus: true, style: "border: 1px solid #54595F" %>
  </div>
  <div class="field">
    <%= f.label :introduction, 'グループ紹介（必須）' %><br />
    <%= f.text_area :introduction, autofocus: true, style: "border: 1px solid #54595F" %>
  </div>

  <% if @members %>
    <div class="field">
      <h3>メンバー</h3>
      <% @members.where.not(id: current_user.id).each do |user| %>
        <div>
          <input name="group[user_ids][]" type="hidden" value=<%= user.id %>><%= user.nickname %>
          <span style="border: 1px solid #54595F;" id="mem">削除</span>
        </div>
      <% end %>

      <script>
        var deles = document.querySelectorAll("#mem");
        for (var i=0; i < deles.length; i++) {
          var ddd = deles[i].parentNode;
          deles[i].addEventListener('click', () => {
            ddd.remove();
          })
        };
      </script>
      <h3>メンバー追加</h3>
      <div>
        <select name="group[user_ids][]">
          <option value="">グループメンバーを選択してください</option>
            <% @add_members.each do |user| %>
              <option value=<%= user.id %>><%= user.nickname %></option>
            <% end %>
        </select>
      </div>
  <% else %>
    <div class="field">
      <div>
        <select name="group[user_ids][]" id="select-user">
          <option value="">グループに招待するユーザーを選択してください</option>
            <% User.where.not(id: current_user.id).each do |user| %>
              <option value=<%= user.id %>><%= user.nickname %></option>
            <% end %>
        </select>
      </div>
  <% end%>
  
    <div id="add-field"></div>
    
    <input name="group[user_ids][]" type="hidden" value=<%= current_user.id %>>

    <button type="button" id="add-btn">ユーザー追加</button>
  </div>
  <div>
    <%= f.submit '登録'%>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const addBtn = document.getElementById('add-btn');
  if (!addBtn) return null;

  const selectUser = document.getElementById('select-user');
  const addField = document.getElementById('add-field');
  addBtn.addEventListener('click', function(){
    console.log("click");
    addField.appendChild(selectUser.cloneNode(true));
  });
});
</script>